<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Viz Dashboard</title>
    <!-- 3rd Party -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/cacfa2197b.js"></script>
    <!-- App -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/charts.css">
    <link rel="stylesheet" href="css/d3-context-menu.css">
</head>

<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar navbar-dark bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Visualization Dashboard</a>
        <a class="text-light" href="#" data-toggle="modal" data-target="#about-modal">About</a>
        <!-- <a class="text-light" href="#" data-toggle="modal" data-target="#feedback-modal">Submit Feedback</a> -->
        <select id="chart-selection" class="col-sm-2 custom-select">
            <option value="default">Select chart</option>
            <option value="simple-tree">Simple Tree</option>
            <option value="radial-tree">Radial Tree</option>
            <option value="treemap">Treemap (coming soon)</option>
        </select>
    </nav>

    <!-- Main view -->
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- Sidebar -->
            <div class="col-lg-2 bg-light shadow">
                <div class="sidebar py-3 d-flex flex-column h-100">
                    <div class="sidebar-item">
                        <label for="files" class="text-primary">Datasets</label>
                        <button class="btn btn-sm btn-light" data-toggle="modal" data-target="#datasets-modal"><i class="fas fa-info-circle"></i></button>
                        <select id="uploaded-files" class="form-control" size="15">
                            <option class="sample-data"">sample1.csv</option>
                            <option class="sample-data"">sample2.csv</option>
                        </select>
                    </div>
                    <input type="file" id="file-upload" style="display: none;" multiple/>
                    <button class="sidebar-item btn btn-sm btn-outline-primary btn-block" onclick="document.getElementById('file-upload').click();">Upload</button>
                    <div id="toolbar" class="sidebar-item btn-group">
                        <button class="btn btn-sm btn-outline-dark" id="zoom-in"><i class="fas fa-search-plus"></i></button>
                        <button class="btn btn-sm btn-outline-dark" id="zoom-out"><i class="fas fa-search-minus"></i></button>
                        <button class="btn btn-sm btn-outline-dark" id="font-up"><i class="fas fa-font"></i><sup>+</sup></button>
                        <button class="btn btn-sm btn-outline-dark" id="font-down"><i class="fas fa-font"></i><sup>-</sup></button>
                        <button class="btn btn-sm btn-outline-dark" id="toggle-node-labels"><i class="fas fa-font"></i></button>
                        <button class="btn btn-sm btn-outline-dark" id="toggle-node-circles"><i class="fas fa-genderless"></i></button>
                        <button class="btn btn-sm btn-outline-primary" id="toggle-node-labels" data-toggle="modal" data-target="#tools-modal"><i class="fas fa-question"></i></button>
                    </div>
                    <label for="color-slider" id="color-rank" class="my-0">Color by</label>
                    <input type="range" id="color-slider" class="custom-range" name="color-slider" value="2" min="2" max="8" step="1" disabled>
                    <div class="sidebar-item mt-auto border">
                        <svg id="mini-chart" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                </div>
            </div>
            <!-- Visualization window -->
            <div class="col-lg-10">
                <div id="main-view" class="p-2 h-100 d-flex flex-column justify-content-between">
                    <div class="row chart border flex-fill my-1">
                        <svg id="chart-display" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="row">
                        <div class="offset-sm-10 dropup btn-block">
                            <button type="button" class="btn btn-sm btn-outline-success btn-block dropdown-toggle" data-toggle="dropdown">
                                Export
                            </button>
                            <div class="dropdown-menu">
                                <button id="convert-png" class="dropdown-item">PNG (coming soon)</button>
                                <button id="convert-svg" class="dropdown-item">SVG</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tooltip"></div>

    <!-- About Modal -->
    <div class="modal fade" id="about-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">About</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>A suite of metaproteomics data visualization tools.</p>
                    <p>This project was started this summer in 2019 and is currently under development. Features and bug fixes are being pushed out every week.</p>
                    <footer class="blockquote-footer">Thomas Hai Li</footer>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Feedback Modal -->
    <div class="modal fade" id="feedback-modal" tabindex="-1">
        <form method="POST" action="/feedback">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Feedback</h5>
                        <button type="button" class="close" data-dismiss="modal">
                            <span>&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="feedback-name">Name</label>
                            <input type="name" class="form-control" id="feedback-name" placeholder="Leave blank for anonymous">
                        </div>
                        <div class="form-group">
                            <label for="feedback-comments">Comments</label>
                            <textarea class="form-control" id="feedback-comments" rows="5"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-success" data-dismiss="modal">Submit</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Datasets Modal -->
    <div class="modal fade" id="datasets-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tips</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h6 class="text-primary">File format</h6>
                    <p>Files should be of type <strong>csv</strong> and obtained from iMetaLab's data processing module.</p>
                    <h6 class="text-primary">Uploading Datasets</h6>
                    <p>To quickly skim through datasets, you can select as many files as you'd like after
                        pressing the upload button. To visualize a dataset, simply select an item from the list.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tools Modals (5) -->
    <div class="modal fade" id="tools-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tips</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>While visualizing a dataset, you may find some tools to be helpful for filtering and focusing on particular data points...</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" data-toggle="modal" data-target="#filtering-tools-modal"><i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="filtering-tools-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tips</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h6 class="text-success">Filtering</h6>
                    <p><i class="fas fa-genderless text-success"></i> Collapse children nodes by clicking on a data point. This may also yield performance boosts.</p>
                    <p><i class="fas fa-sliders-h text-success"></i> Use the slider to color nodes based on different taxonomy levels.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" data-toggle="modal" data-target="#tools-modal"><i class="fas fa-arrow-left"></i></button>
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" data-toggle="modal" data-target="#focusing-tools-modal"><i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="focusing-tools-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tips</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">                    
                    <h6 class="text-primary">Focusing</h6>
                    <p><i class="fas fa-genderless text-primary"></i> View the average MS intensity for a data point by hovering over a single node.</p>
                    <p><i class="fas fa-genderless text-primary"></i> View individual MS intensities for a data point by
                        right-clicking on the node. The data will be displayed in the mini chart on the bottom left corner.</p>
                </div>
                <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" data-toggle="modal" data-target="#filtering-tools-modal"><i class="fas fa-arrow-left"></i></button>
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" data-toggle="modal" data-target="#charts-tools-modal"><i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="charts-tools-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tips</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">                    
                    <h6 class="text-success">Charts</h6>
                    <p>Different charts communicate different insights. Select a chart from the top-right dropdown menu.</p>
                    <p>
                        <span class="text-success"><i class="fas fa-chart-bar"></i> Simple trees</span>
                        are great for displaying relationships between MS-identified species.
                        Nodes are sorted by their average MS intensity in ascending order, from the top to the bottom of the chart. 
                    </p>
                    <p><span class="text-success"><i class="fas fa-chart-bar"></i> Radial trees</span>
                        not only display how different taxa are related, but intuitively show the proportion
                        of taxa with the help of color and their circular nature.
                        Nodes are sorted by their average MS intensity in ascending order.
                    </p>
                    <p><span class="text-success"><i class="fas fa-chart-bar"></i> Treemaps</span>
                        use nested rectangles to display hierarchical data.
                        Each rectangle represents a single taxon and its area is proportional to its averaged MS intensity.
                    </p>
                </div>
                <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" data-toggle="modal" data-target="#focusing-tools-modal"><i class="fas fa-arrow-left"></i></button>
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" data-toggle="modal" data-target="#utilities-tools-modal"><i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="utilities-tools-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tips</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">                  
                    <h6 class="text-dark">Utilities</h6>
                    <p><i class="fas fa-search text-dark"></i> Zoom by scrolling on the graphics or by using the toolbar.</p>
                    <p><i class="fas fa-arrows-alt"></i> Pan the view by dragging on the graphics.</p>
                    <p><i class="fas fa-font text-dark"></i> Toggle and resize labels by using the toolbar.</p>
                    <p><i class="fas fa-genderless text-dark"></i> Node sizes are based off the average MS intensity. Normalize all node sizes by using the toolbar.</p>
                </div>
                <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal" data-toggle="modal" data-target="#charts-tools-modal"><i class="fas fa-arrow-left"></i></button>
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div class="modal fade" id="warning-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Warning</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>One or more files did not match the correct format (.csv) and were not added to the list.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- BS4 -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <!-- D3 App -->
    <script src="js/d3.js"></script>
    <script type="text/javascript" src="js/d3-context-menu.js"></script>
    <script type="text/javascript" src="js/view-tree.js"></script>
    <script type="text/javascript" src="js/view-datasets.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
</body>
</html>
